import os

def run_openvas_scan(target):
    scan_name = "Automated Scan"  # Set a name for the scan
    report_format = "PDF"  # Specify the desired report format (e.g., PDF, HTML)

    # Run the OpenVAS scan command
    command = f"omp -u admin -w admin --xml='<create_task><name>{scan_name}</name><target>{target}</target></create_task>'"
    os.system(command)

    # Retrieve the latest task ID
    command = "omp -u admin -w admin -G"
    output = os.popen(command).read()
    task_id = None
    for line in output.splitlines():
        if scan_name in line:
            task_id = line.split()[0]
            break

    if task_id:
        # Start the scan
        command = f"omp -u admin -w admin -S {task_id}"
        os.system(command)
        print("Scan started successfully.")

        # Wait for the scan to complete
        while True:
            command = f"omp -u admin -w admin -G {task_id}"
            output = os.popen(command).read()
            if "Done" in output:
                break

        # Generate the report
        command = f"omp -u admin -w admin --get-report {task_id} --reportformat {report_format} > scan_report.{report_format.lower()}"
        os.system(command)
        print("Scan report generated successfully.")
    else:
        print("Error: Task ID not found.")

# Example usage
target_ip = "192.168.1.1"  # Replace with the IP address or hostname of the target
run_openvas_scan(target_ip)

