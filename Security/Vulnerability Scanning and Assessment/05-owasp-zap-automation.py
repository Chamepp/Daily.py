import time
from zapv2 import ZAPv2

# OWASP ZAP API endpoint
zap_api = "http://localhost:8080/"

# Target URL to scan
target_url = "http://example.com"

# Create ZAP instance
zap = ZAPv2(apikey='your_api_key', proxies={'http': zap_api, 'https': zap_api})

# Start ZAP session
zap.core.new_session()

# Access the target URL
zap.urlopen(target_url)
time.sleep(2)  # Give some time for the page to load

# Spider the target URL to discover all accessible pages
zap.spider.scan(target_url)
time.sleep(5)  # Wait for the spider to finish

# Wait until the spider has completed 100%
while int(zap.spider.status()) < 100:
    time.sleep(1)

# Scan the target URL for vulnerabilities
zap.ascan.scan(target_url)
time.sleep(5)  # Wait for the active scan to finish

# Wait until the active scan has completed 100%
while int(zap.ascan.status()) < 100:
    time.sleep(1)

# Get the alerts generated by the scan
alerts = zap.core.alerts(baseurl=target_url)

# Print the alerts
for alert in alerts:
    print(f"Alert: {alert['alert']} - Risk Level: {alert['risk']}")

